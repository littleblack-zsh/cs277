# ç½‘æ ¼äº¤æ˜“å›æµ‹ç³»ç»Ÿ

åŸºäºå†å²æ•°æ®çš„è‚¡ç¥¨ç½‘æ ¼äº¤æ˜“ç­–ç•¥å›æµ‹ç³»ç»Ÿã€‚æ”¯æŒå›ºå®šç½‘æ ¼å’ŒATRè‡ªé€‚åº”ç½‘æ ¼ä¸¤ç§ç­–ç•¥ã€‚

## é¡¹ç›®ç®€ä»‹

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªè¯¾ç¨‹é¡¹ç›®ï¼Œç”¨äºç ”ç©¶å’Œåˆ†æç½‘æ ¼äº¤æ˜“ç­–ç•¥åœ¨Aè‚¡å¸‚åœºçš„è¡¨ç°ã€‚ä¸»è¦åŠŸèƒ½åŒ…æ‹¬ï¼š

- ğŸ“Š æ•°æ®æ¸…æ´—ä¸é¢„å¤„ç†
- ğŸ” åŸºäºæµåŠ¨æ€§å’Œæ³¢åŠ¨ç‡çš„æ ‡çš„ç­›é€‰
- ğŸ“ˆ å›ºå®šç½‘æ ¼é—´è·ç­–ç•¥å›æµ‹
- ğŸ¯ ATRè‡ªé€‚åº”ç½‘æ ¼ç­–ç•¥å›æµ‹
- ğŸ“‰ å¤šç»´åº¦ç»©æ•ˆè¯„ä¼°ï¼ˆå¤æ™®æ¯”ç‡ã€æœ€å¤§å›æ’¤ã€å¡ç›æ¯”ç‡ç­‰ï¼‰
- ğŸ“‹ äº¤æ˜“æ˜ç»†å¯¼å‡ºä¸å¯è§†åŒ–åˆ†æ

## ç¯å¢ƒé…ç½®

### 1. å…‹éš†ä»“åº“
```bash
git clone <your-repository-url>
cd grid-trading-backtest
```

### 2. å®‰è£…ä¾èµ–
```bash
pip install -r requirements.yaml
```

### 3. æ•°æ®å‡†å¤‡
å°†ä¸Šè¯æ•°æ®è§£å‹åˆ° `ä¸Šè¯ä¿¡æ¯æ•°æ®2024/his_sh1_201907-202406/` ç›®å½•ä¸‹ï¼Œç¡®ä¿ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š
```
grid-trading-backtest/          # é¡¹ç›®æ ¹ç›®å½•
  data_clean.py
  grid.py
  select_stock.py
  ä¸Šè¯ä¿¡æ¯æ•°æ®2024/
    his_sh1_201907-202406/
      20191113/
        Day.csv
      20191114/
        Day.csv
      ...
```

## å¿«é€Ÿå¼€å§‹

### è¿è¡Œå›ºå®šç½‘æ ¼ç­–ç•¥å›æµ‹
```bash
python grid.py
```

### è¿è¡ŒATRè‡ªé€‚åº”ç½‘æ ¼ç­–ç•¥å¯¹æ¯”
```bash
python example_atr_adaptive_grid.py
```

### è¿è¡Œå®Œæ•´å·¥ä½œæµï¼ˆç­›é€‰+å›æµ‹ï¼‰
```bash
python example_correct_workflow.py
```

## å®éªŒè¯´æ˜

### å®éªŒ1ï¼šå•åªè‚¡ç¥¨å›æµ‹
ä¿®æ”¹ `example_atr_adaptive_grid.py` ä¸­çš„å‚æ•°ï¼š
```python
security_id = "000008"  # ä¿®æ”¹ä¸ºç›®æ ‡è‚¡ç¥¨ä»£ç 
selection_start = "2020-01-01"  # é€‰è‚¡æœŸå¼€å§‹
selection_end = "2022-12-31"    # é€‰è‚¡æœŸç»“æŸ
backtest_start = "2023-01-01"   # å›æµ‹æœŸå¼€å§‹
backtest_end = "2024-06-20"     # å›æµ‹æœŸç»“æŸ
```

è¿è¡Œï¼š
```bash
python example_atr_adaptive_grid.py
```

### å®éªŒ2ï¼šæ‰¹é‡è‚¡ç¥¨å›æµ‹
ä¿®æ”¹ `example_correct_workflow.py` ä¸­ç­›é€‰æ¡ä»¶ï¼š
```python
candidates = select_grid_candidates(
    metrics,
    min_avg_amount=2e7,      # æ—¥å‡æˆäº¤é¢é˜ˆå€¼
    vol_range=(0.15, 0.5),   # å¹´åŒ–æ³¢åŠ¨ç‡èŒƒå›´
    max_abs_ret=0.10         # æ”¶ç›Šç‡ä¸Šé™
)
```

è¿è¡Œï¼š
```bash
python example_correct_workflow.py
```

### å®éªŒ3ï¼šå‚æ•°æ•æ„Ÿæ€§åˆ†æ
`example_atr_adaptive_grid.py` ä¼šè‡ªåŠ¨æ‰«æä¸åŒATRä¹˜æ•°ï¼ˆ0.5~2.0ï¼‰çš„è¡¨ç°ã€‚

å¯ä¿®æ”¹æ‰«æèŒƒå›´ï¼š
```python
multipliers = [0.5, 0.75, 1.0, 1.25, 1.5, 2.0]  # è‡ªå®šä¹‰æ‰«æç‚¹
```

## è¾“å‡ºæ–‡ä»¶

è¿è¡Œå®éªŒåä¼šç”Ÿæˆä»¥ä¸‹æ–‡ä»¶ï¼š

- `{è‚¡ç¥¨ä»£ç }_grid_trades.csv` - å›ºå®šç½‘æ ¼äº¤æ˜“è®°å½•
- `{è‚¡ç¥¨ä»£ç }_atr_adaptive_trades.csv` - ATRè‡ªé€‚åº”äº¤æ˜“è®°å½•
- `{è‚¡ç¥¨ä»£ç }_atr_comparison.png` - ç­–ç•¥å¯¹æ¯”å›¾è¡¨
- `backtest_summary.csv` - æ‰¹é‡å›æµ‹æ±‡æ€»ç»“æœ

## æ ¸å¿ƒæ¨¡å—è¯´æ˜

| æ–‡ä»¶ | åŠŸèƒ½ |
|------|------|
| `data_clean.py` | æ•°æ®åŠ è½½ä¸æ¸…æ´— |
| `select_stock.py` | æ ‡çš„ç­›é€‰ä¸æŒ‡æ ‡è®¡ç®— |
| `grid.py` | ç½‘æ ¼ç­–ç•¥æ ¸å¿ƒå®ç° |
| `example_atr_adaptive_grid.py` | ATRç­–ç•¥ç¤ºä¾‹ï¼ˆæ¨èï¼‰ |
| `example_correct_workflow.py` | å®Œæ•´å·¥ä½œæµç¤ºä¾‹ |

## è¯„ä¼°æŒ‡æ ‡

ç³»ç»Ÿè‡ªåŠ¨è®¡ç®—ä»¥ä¸‹æŒ‡æ ‡ï¼š

- **å¹´åŒ–æ”¶ç›Šç‡**ï¼šè€ƒè™‘å¤åˆ©çš„å¹´åŒ–å›æŠ¥
- **å¤æ™®æ¯”ç‡**ï¼šé£é™©è°ƒæ•´åæ”¶ç›Šï¼ˆå‡è®¾æ— é£é™©åˆ©ç‡3%ï¼‰
- **æœ€å¤§å›æ’¤**ï¼šä»å³°å€¼åˆ°è°·å€¼çš„æœ€å¤§è·Œå¹…
- **å¡ç›æ¯”ç‡**ï¼šå¹´åŒ–æ”¶ç›Š/æœ€å¤§å›æ’¤
- **äº¤æ˜“é¢‘ç‡**ï¼šå¹´åŒ–äº¤æ˜“æ¬¡æ•°
- **è¶…é¢æ”¶ç›Š**ï¼šç›¸å¯¹ä¹°å…¥æŒæœ‰çš„è¶…é¢å¹´åŒ–æ”¶ç›Š

## æ³¨æ„äº‹é¡¹

âš ï¸ **é¿å…å‰è§†åå·®**ï¼š
- é€‰è‚¡æœŸç”¨äºç¡®å®šç­–ç•¥å‚æ•°ï¼ˆå¦‚ç½‘æ ¼é—´è·ï¼‰
- å›æµ‹æœŸç”¨äºéªŒè¯ç­–ç•¥è¡¨ç°
- ä¸¤ä¸ªæ—¶é—´æ®µä¸èƒ½é‡å ï¼

âœ… **æ­£ç¡®åšæ³•**ï¼š
```python
# åœ¨é€‰è‚¡æœŸï¼ˆ2020-2022ï¼‰ç¡®å®šå‚æ•°
fixed_step = suggest_grid_step(price_selection)

# åœ¨å›æµ‹æœŸï¼ˆ2023-2024ï¼‰æ‰§è¡Œç­–ç•¥
equity_df, trades_df = run_grid_backtest(price_backtest, fixed_step)
```

âŒ **é”™è¯¯åšæ³•**ï¼š
```python
# ç›´æ¥ç”¨å…¨éƒ¨æ•°æ®æ—¢ç¡®å®šå‚æ•°åˆå›æµ‹
price_df = get_price_series("2020-01-01", "2024-06-20")
fixed_step = suggest_grid_step(price_df)  # åŒ…å«æœªæ¥ä¿¡æ¯ï¼
equity_df, trades_df = run_grid_backtest(price_df, fixed_step)
```

## å¸¸è§é—®é¢˜

### Q: å¦‚ä½•ä¿®æ”¹åˆå§‹èµ„é‡‘ï¼Ÿ
A: ä¿®æ”¹ `total_capital` å‚æ•°ï¼š
```python
total_capital = 100000.0  # 10ä¸‡å…ƒ
```

### Q: å¦‚ä½•è°ƒæ•´äº¤æ˜“é¢‘ç‡ï¼Ÿ
A: ä¿®æ”¹ç½‘æ ¼é—´è·æˆ–ATRä¹˜æ•°ï¼š
```python
# å›ºå®šç½‘æ ¼ï¼šå¢å¤§factoré™ä½äº¤æ˜“é¢‘ç‡
fixed_step = suggest_grid_step(price_df, factor=2.0)

# ATRè‡ªé€‚åº”ï¼šå¢å¤§multiplieré™ä½äº¤æ˜“é¢‘ç‡
atr_multiplier = 1.5
```

### Q: å›¾è¡¨ä¸­æ–‡æ˜¾ç¤ºä¹±ç ï¼Ÿ
A: å·²é…ç½®å¤šä¸ªä¸­æ–‡å­—ä½“ï¼Œå¦‚ä»æœ‰é—®é¢˜ï¼Œæ£€æŸ¥ç³»ç»Ÿå·²å®‰è£…å­—ä½“ï¼š
```python
from matplotlib.font_manager import FontManager
fm = FontManager()
fonts = [f.name for f in fm.ttflist if 'Hei' in f.name or 'YaHei' in f.name]
print(set(fonts))
```

## è´¡çŒ®æŒ‡å—

1. Forkæœ¬ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/your-feature`)
3. æäº¤æ›´æ”¹ (`git commit -am 'Add some feature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/your-feature`)
5. åˆ›å»ºPull Request

## è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æäº¤Issueæˆ–è”ç³»é¡¹ç›®ç»´æŠ¤è€…ã€‚

## è®¸å¯è¯

æœ¬é¡¹ç›®ä»…ä¾›å­¦ä¹ ç ”ç©¶ä½¿ç”¨ã€‚
